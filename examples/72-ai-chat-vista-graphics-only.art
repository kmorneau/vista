import "vista.art"!

ARTURO [
    Title: "Vista AI Chat"
    Logo: "ai-chat-logo.png"
    Width: 1240
    Height: 780
    PrimaryColor: "#6aa3e9"
    BackgroundColor: "#f5f4f2"
    TitleColor: "#1f1f1f"
    TextColor: "#1f1f1f"
]

selected_nav: "Chat"
nav_items: ["Chat" "Settings"]

api_base: "http://localhost:18969"
provider: "openai"
model: "gpt-4o-mini"
temperature: "0.2"
top_p: "0.9"
max_tokens: "128"

provider_options: ["openai" "gemini"]
model_options: ["gpt-4o-mini" "gpt-4.1-mini" "gemini-2.0-flash" "gemini-2.0-flash-lite"]
temperature_options: ["0.0" "0.2" "0.4" "0.7" "1.0"]
top_p_options: ["0.7" "0.9" "1.0"]
max_tokens_options: ["64" "128" "256" "512"]

chat_log: "ai: Hello. Send a prompt to start chatting."
message: ""
status: "Ready"
email: ""
password: ""
mfa_code: ""
new_email: ""
old_password: ""
new_password: ""
profile_label: "Signed out"
auth_token: ""
auth_status: "Ready"
mfa_challenge: ""
show_splash: false
show_login: false
show_signup: false
show_account: false
show_intro_splash: true

vista_css: vista_css ++
    ".vista-auth-card{max-width:760px !important;width:100%;}" ++
    ".vista-auth-card .vista-panel-body .vista-row{gap:14px;align-items:center;margin-bottom:12px;}" ++
    ".vista-auth-card .vista-panel-body input[type='text'],.vista-auth-card .vista-panel-body input[type='password'],.vista-auth-card .vista-panel-body input[type='email'],.vista-auth-card .vista-panel-body textarea,.vista-auth-card .vista-panel-body select{min-width:420px;width:100%;}" ++
    ".vista-auth-card .vista-panel-body button{margin-top:6px;}" ++
    ".vista-auth-card .vista-col{gap:12px;}"

cwd_path: strip execute "pwd"
ui_name: "ui-72-ai-chat-vista-graphics-only.html"
ui_path: cwd_path ++ "/" ++ ui_name

full_html: view .returnHtml [
    box .style:"display:none" [
        field show_intro_splash .type:"hidden"
    ]
    split .ratio:16 .style:"min-height:700px;gap:12px;" [
        box .style:"background:#f3f2f0;border:1px solid #e6e3df;border-radius:16px;padding:14px;min-height:700px;" [
            text "Vista Chat" .style:"font-weight:800;font-size:18px;margin-bottom:4px;"
            canvas .id:"chat-badge" .width:180 .height:64 .style:"width:100%;max-width:180px;border:1px solid #ded6c2;border-radius:10px;background:#ffffff;margin-bottom:10px;" [
                fill-pen "#edf1ff"
                box [0 0] [180 64]
                fill-pen "#4a55ff"
                circle [20 22] 8
                circle [46 22] 8
                fill-pen "#141414"
                text [10 52] "Vista AI"
            ]
            list selected_nav nav_items .style:"border:none;background:transparent;"
        ]
    ] [
        box .style:"background:linear-gradient(180deg,#faf9f7 0%,#f3f2ef 100%);border:1px solid #e6e3df;border-radius:16px;padding:16px 14px;min-height:700px;display:flex;flex-direction:column;gap:10px;" [
            title "AI Chat" .style:"font-size:26px;font-weight:800;margin:2px 0 8px;"
            box .data-show-bind:"show_account" .data-show-value:"true" .style:"display:flex;align-items:center;justify-content:space-between;gap:8px;margin-bottom:2px;" [
                text profile_label .style:"font-size:12px;color:#6f6f6f;"
                button "Sign out" .data-vista-action:"auth_logout" .style:"background:#fff;color:#1f1f1f;border:1px solid #e6e3df;border-radius:10px;padding:6px 12px;font-weight:700;"
            ]

            box .data-show-bind:"show_account" .data-show-value:"true" [
                box .data-show-bind:"selected_nav" .data-show-value:"Chat" .style:"display:flex;flex-direction:column;gap:10px;" [
                    text "Conversation" .style:"font-size:12px;color:#6f6f6f;"
                    textarea chat_log .style:"width:100%;min-height:340px;border:1px solid #e6e3df;border-radius:12px;padding:10px 12px;background:#fff;white-space:pre-wrap;overflow:auto;"

                    text "Prompt" .style:"font-size:12px;color:#6f6f6f;"
                    textarea message .placeholder:"Type your message..." .style:"width:100%;min-height:90px;border:1px solid #e6e3df;border-radius:12px;padding:10px 12px;background:#fff;"

                    row .space:8 .style:"align-items:center;flex-wrap:wrap;margin-top:4px;" [
                        button "Send" [
                            ai_chat #[
                                token_key: "auth_token"
                            ]
                        ] .style:"background:#4a55ff;color:#fff;border:none;border-radius:10px;padding:8px 14px;font-weight:700;"
                        button "Clear" [
                            chat_log: "ai: Hello. Send a prompt to start chatting."
                            message: ""
                            status: "Ready"
                        ] .style:"background:#fff;color:#1f1f1f;border:1px solid #e6e3df;border-radius:10px;padding:8px 14px;font-weight:700;"
                        text status .style:"font-size:12px;color:#6f6f6f;"
                    ]
                ]
            ]

            box .data-show-bind:"show_account" .data-show-value:"true" [
                box .data-show-bind:"selected_nav" .data-show-value:"Settings" .style:"display:flex;flex-direction:column;gap:10px;" [
                    text "AI Settings" .style:"font-size:20px;font-weight:800;"
                    row .space:10 .style:"align-items:flex-end;flex-wrap:wrap;" [
                        col .space:4 .style:"min-width:220px;flex:1;" [
                            text "API base URL" .style:"font-size:12px;color:#6f6f6f;"
                            field api_base .id:"api-base" .style:"width:100%;border:1px solid #e6e3df;border-radius:10px;padding:8px 10px;background:#fff;font-size:12px;"
                        ]
                        col .space:4 [
                            text "Provider" .style:"font-size:12px;color:#6f6f6f;"
                            select provider provider_options .style:"min-width:150px;border:1px solid #e6e3df;border-radius:10px;padding:8px 10px;background:#fff;font-size:12px;"
                        ]
                        col .space:4 [
                            text "Model" .style:"font-size:12px;color:#6f6f6f;"
                            select model model_options .style:"min-width:220px;border:1px solid #e6e3df;border-radius:10px;padding:8px 10px;background:#fff;font-size:12px;"
                        ]
                        col .space:4 [
                            text "Temperature" .style:"font-size:12px;color:#6f6f6f;"
                            select temperature temperature_options .style:"min-width:110px;border:1px solid #e6e3df;border-radius:10px;padding:8px 10px;background:#fff;font-size:12px;"
                        ]
                        col .space:4 [
                            text "Top P" .style:"font-size:12px;color:#6f6f6f;"
                            select top_p top_p_options .style:"min-width:110px;border:1px solid #e6e3df;border-radius:10px;padding:8px 10px;background:#fff;font-size:12px;"
                        ]
                        col .space:4 [
                            text "Max tokens" .style:"font-size:12px;color:#6f6f6f;"
                            select max_tokens max_tokens_options .style:"min-width:120px;border:1px solid #e6e3df;border-radius:10px;padding:8px 10px;background:#fff;font-size:12px;"
                        ]
                    ]
                    row .space:8 .style:"align-items:center;flex-wrap:wrap;margin-top:4px;" [
                        button "Load settings" [
                            ai_settings_load
                        ] .style:"background:#fff;color:#1f1f1f;border:1px solid #e6e3df;border-radius:10px;padding:8px 14px;font-weight:700;"
                        button "Save settings" [
                            ai_settings_save
                        ] .style:"background:#4a55ff;color:#fff;border:none;border-radius:10px;padding:8px 14px;font-weight:700;"
                        text status .style:"font-size:12px;color:#6f6f6f;"
                    ]
                ]
            ]
            box .data-show-bind:"show_account" .data-show-value:"false" .style:"display:flex;flex-direction:column;align-items:center;justify-content:center;min-height:620px;" [
                auth_app "Vista AI Chat" "Sign in or sign up to begin chatting."
            ]
            box .data-show-bind:"show_intro_splash" .data-show-value:"true" .style:"position:fixed;inset:0;z-index:9999;background:rgba(15,23,42,0.68);padding:20px;" [
                box .style:"position:absolute;top:50%;left:50%;transform:translate(-50%,-50%);width:min(680px,calc(100% - 40px));background:var(--arturo-primary);border:2px solid #1f1f1f;border-radius:16px;padding:28px;box-shadow:0 24px 60px rgba(2,6,23,0.35);text-align:center;" [
                    image "ai-chat-logo.png" .size:"96x96" .style:"width:96px;height:96px;object-fit:contain;margin:0 auto 8px;display:block;"
                    title "Vista AI Chat" .style:"font-size:34px;font-weight:800;color:#1f1f1f;margin:0 0 8px;"
                ]
            ]
        ]
    ]
]

splash_script: "<script>(function(){var start=function(){setTimeout(function(){if(typeof state!=='object'){return;}if(state.show_account===true){return;}state.show_intro_splash=false;state.show_splash=false;state.show_login=true;state.show_signup=false;if(typeof render==='function'){render();}},5000);};if(document.readyState==='complete'){start();}else{window.addEventListener('load',start,{once:true});}})();</script>"
final_html: replace full_html "</body>" splash_script ++ "</body>"

write final_html ui_path
safe_ui_path: replace ui_path "\"" "\\\""
execute "open \"" ++ safe_ui_path ++ "\" >/dev/null 2>&1 &"
print ["Opened in browser:" ui_path]
