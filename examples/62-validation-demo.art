import "vista.art"!

ARTURO [
    Title: "Validation Demo"
    Logo: "arturo-vista.png"
    Width: 920
    Height: 620
]

name: ""
email: ""
age: ""
password: ""
confirm: ""
status: "Fill the form and click Validate"

err_name: ""
err_email: ""
err_age: ""
err_password: ""
err_confirm: ""

contains_char?: function [txt ch] [
    if equal? txt null [return false]
    not? equal? (index (to :string txt) ch) null
]

validate_demo_form: function [] [
    err_name: ""
    err_email: ""
    err_age: ""
    err_password: ""
    err_confirm: ""

    if equal? (strip name) "" [err_name: "Name is required"]

    if equal? (strip email) "" [
        err_email: "Email is required"
    ] [
        if not? all? @[contains_char? email "@" contains_char? email "."] [
            err_email: "Email format is invalid"
        ]
    ]

    age_num: to :integer age
    if any? @[less? age_num 18 greater? age_num 120] [err_age: "Age must be between 18 and 120"]

    if less? (size password) 8 [err_password: "Password must be at least 8 characters"]

    if not? equal? password confirm [err_confirm: "Passwords do not match"]

    has_err: false
    loop [err_name err_email err_age err_password err_confirm] 'x [
        if not? equal? (to :string x) "" [has_err: true]
    ]

    if has_err [
        status: "Validation failed. Please fix highlighted fields."
    ] [
        status: "Validation passed."
    ]
]

clear_demo_form: function [] [
    name: "" email: "" age: "" password: "" confirm: ""
    err_name: "" err_email: "" err_age: "" err_password: "" err_confirm: ""
    status: "Form cleared."
]

view .file:"ui.html" [
    title "Form Validation Demo"

    text "Name (required)"
    field name
    text err_name

    text "Email (required)"
    field email
    text err_email

    text "Age (18-120)"
    field age
    text err_age

    text "Password (min 8 chars)"
    field password .type:"password"
    text err_password

    text "Confirm Password"
    field confirm .type:"password"
    text err_confirm

    row .space:8 [
        button "Validate" [validate_demo_form]
        button "Clear" [clear_demo_form]
    ]

    text status
]
